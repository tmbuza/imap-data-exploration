[{"path":"index.html","id":"data-exploration","chapter":"IMAP-Part 08: Microbiome Data Exploration Guide","heading":"IMAP-Part 08: Microbiome Data Exploration Guide","text":"","code":""},{"path":"index.html","id":"welcome-to-chapter-8","chapter":"IMAP-Part 08: Microbiome Data Exploration Guide","heading":"Welcome to chapter 8","text":"Welcome “Data Exploration” chapter, transition meticulous preparation microbiome data fascinating realm exploration. phase, embark journey uncover patterns, relationships, insights within datasets. Whether just beginning journey microbiome research years experience analyst, methodologies outlined chapter crafted empower , providing means uncover insights extract valuable knowledge","code":""},{"path":"preface.html","id":"preface","chapter":"1 Exploring Microbial Composition","heading":"1 Exploring Microbial Composition","text":"chapter, shift focus meticulous process data preparation dynamic enlightening stage “Data Exploration.” microbiome data now refined optimized, exploration phase becomes pivotal step research journey. preface sets stage exploration, addressing novice researcher seeking fundamental insights seasoned analyst eager uncover intricate patterns within microbial communities.","code":""},{"path":"preface.html","id":"the-significance-of-data-exploration","chapter":"1 Exploring Microbial Composition","heading":"1.1 The Significance of Data Exploration","text":"Data exploration critical phase data analysis pipeline, researcher engages dataset understand structure, identify patterns, generate hypotheses. phase goes beyond realm summary statistics ventures visual representation data, hypothesis testing, discovery trends may guide subsequent analyses.","code":""},{"path":"preface.html","id":"what-to-expect","chapter":"1 Exploring Microbial Composition","heading":"1.2 What to Expect","text":"pages follow, provide comprehensive guide data exploration techniques tailored specifically microbiome datasets. foundational concepts advanced visualizations, chapter covers spectrum approaches. Whether embarking first exploration seeking enhance analytical toolkit, guide offers step--step instructions, best practices, practical insights.","code":""},{"path":"preface.html","id":"navigating-the-chapter","chapter":"1 Exploring Microbial Composition","heading":"1.3 Navigating the Chapter","text":"chapter unfolds logical sequence, starting basic exploratory techniques progressing advanced methods. section designed build previous one, providing coherent structured approach understanding interpreting microbiome data. navigate pages, encounter code snippets, visualizations, real-world examples illustrate principles effective data exploration.","code":""},{"path":"preface.html","id":"embark-on-the-exploration","chapter":"1 Exploring Microbial Composition","heading":"1.4 Embark on the Exploration","text":"Data exploration just technical endeavor; journey discovery. embark chapter, embrace iterative nature exploration, allowing curiosity guide analyses. insights gained phase lay foundation targeted investigations, ultimately contributing richer understanding microbial communities study.Whether new data exploration seasoned explorer datasets, chapter invites delve fascinating intricacies microbiome data. Let exploration begin!","code":""},{"path":"getting-started-with-data-exploration.html","id":"getting-started-with-data-exploration","chapter":"2 Getting Started with Data Exploration","heading":"2 Getting Started with Data Exploration","text":"","code":""},{"path":"getting-started-with-data-exploration.html","id":"understand-snakemake-workflows","chapter":"2 Getting Started with Data Exploration","heading":"2.1 Understand Snakemake Workflows","text":"section, provide brief introduction Snakemake, highlighting role creating reproducible scalable data workflows. Emphasize Snakemake facilitates integration multiple scripting languages unified efficient data exploration process.","code":""},{"path":"getting-started-with-data-exploration.html","id":"setting-up-exploration-environment","chapter":"2 Getting Started with Data Exploration","heading":"2.2 Setting Up Exploration Environment","text":"Guide readers process setting environment Snakemake workflows. Include instructions installing Snakemake, creating virtual environment, managing dependencies R Python scripts. Offer code snippets examples better clarity.","code":""},{"path":"getting-started-with-data-exploration.html","id":"basics-of-snakemake-rules","chapter":"2 Getting Started with Data Exploration","heading":"2.3 Basics of Snakemake Rules","text":"Explain fundamental concepts Snakemake rules, including input, output, shell commands. Use simple example related taxa abundance data illustrate define basic rule generating barplots.\nrule create_barplots input: “data/mothur_composite.csv”,\n“data/qiime2_composite.csv” output: “figures/taxon_barplot.png”\n“figures/taxon_barplot.svg” shell: “Rscript scripts/create_barplots.R\n{input} {output}”\n","code":"\nload(\"../imap-data-preparation/data/external/external_ps_objects.rda\", verbose = TRUE)## Loading objects:\n##   df_GlobalPatterns\n##   df_ibd_phylo\n##   df_dietswap\n##   df_caporaso\n##   df_kostic_crc\n##   ps_GlobalPatterns\n##   ps_ibd_phylo\n##   ps_dietswap\n##   ps_caporaso\n##   ps_kostic_crc\nload(\"../imap-data-preparation/data/mothur/mothur_phyloseq_objects.rda\", verbose = TRUE)## Loading objects:\n##   mtps_metadata\n##   mtps_otutable\n##   mtps_taxonomy\n##   mtps_phylotree\n##   ps_tree\n##   ps_raw\n##   ps_rel\nload(\"../imap-data-preparation/data/qiime2/qiime2_phyloseq_objects.rda\", verbose = TRUE)## Loading objects:\n##   ps_tree\n##   ps_raw\n##   ps_rel\n##   ps_df_raw\n##   ps_df_rel"},{"path":"getting-started-with-data-exploration.html","id":"integrating-r-python-and-bash","chapter":"2 Getting Started with Data Exploration","heading":"2.4 Integrating R, Python, and Bash","text":"Demonstrate integrate R, Python, Bash scripts within Snakemake rules. Showcase examples scripting language contributes overall data exploration workflow. Highlight versatility Snakemake orchestrating diverse components.","code":""},{"path":"data-exploration-techniques.html","id":"data-exploration-techniques","chapter":"3 Data Exploration Techniques","heading":"3 Data Exploration Techniques","text":"Cover range data exploration techniques applicable taxa abundance data. Discuss statistical analysis, visualization, exploratory data analysis concepts. Introduce specific analysis goals outline achieved using integrated Snakemake workflows.","code":""},{"path":"visualizations-with-r-and-python.html","id":"visualizations-with-r-and-python","chapter":"4 Visualizations with R and Python:","heading":"4 Visualizations with R and Python:","text":"Delve deeper visualization aspect, providing detailed examples creating barplots using ggplot2 (R) seaborn/matplotlib (Python). Include code snippets, explain parameters, showcase resulting visualizations.","code":"\n# scripts/create_barplots.R\nlibrary(dplyr)## \n## Attaching package: 'dplyr'## The following objects are masked from 'package:stats':\n## \n##     filter, lag## The following objects are masked from 'package:base':\n## \n##     intersect, setdiff, setequal, union\nlibrary(readr)\nlibrary(ggplot2)\nlibrary(svglite)\n\nmo <- read_csv(\"data/mothur_composite.csv\", show_col_types = FALSE) %>% \n  mutate(pipeline=\"MOTHUR\", .before=2) %>% \n  select(-otu, -3)\n\nq2 <- read_csv(\"data/qiime2_composite.csv\", show_col_types = FALSE) %>% \n  mutate(pipeline=\"QIIME2\", .before=2) %>% \n  select(-feature, -c(3:14))\n\nrbind(mo, q2) %>% \n  group_by(sample_id) %>%\n  mutate(total = sum(count)) %>%\n  filter(total > 0) %>%\n  group_by(Genus) %>%\n  mutate(total = sum(count)) %>%\n  # filter(total != 0) %>%\n  filter(total >= 10) %>%\n  ungroup() %>%\n  select(-total)  %>% \n  saveRDS(\"data/mothur_qiime2_merged.rds\")\n\nreadRDS(\"data/mothur_qiime2_merged.rds\") %>% \n  ggplot(aes(x=Genus, y=rel_abund, fill=pipeline)) +\n  facet_grid(~pipeline) +\n  geom_col() +\n  coord_flip() +\n  labs(fill=\"Pipeline\")\nggsave(file=\"figures/taxon_barplot.png\", width=10, height=10)\nggsave(file=\"figures/taxon_barplot.svg\", width=10, height=10)"},{"path":"advanced-snakemake-features.html","id":"advanced-snakemake-features","chapter":"5 Advanced Snakemake Features","heading":"5 Advanced Snakemake Features","text":"Explore advanced Snakemake features enhance workflow efficiency. Discuss dynamic rules, wildcard constraints, conditional execution. Showcase features can applied optimize data exploration workflow.","code":""},{"path":"case-studies-and-examples.html","id":"case-studies-and-examples","chapter":"6 Case Studies and Examples","heading":"6 Case Studies and Examples","text":"Present real-world case studies demonstrating application Snakemake context taxa abundance data. Include examples showcase synergy R, Python, Bash scripts comprehensive data exploration.","code":""},{"path":"case-studies-and-examples.html","id":"best-practices-and-optimization","chapter":"6 Case Studies and Examples","heading":"6.1 Best Practices and Optimization","text":"Provide best practices optimizing Snakemake workflows, emphasizing efficiency reproducibility. Address common challenges suggest strategies effective workflow design context data exploration.","code":""},{"path":"conclusion.html","id":"conclusion","chapter":"7 Conclusion","heading":"7 Conclusion","text":"Summarize key takeaways, highlighting benefits integrated Snakemake workflow data exploration. Encourage readers apply demonstrated techniques research projects.","code":""},{"path":"exploration-of-processded-data.html","id":"exploration-of-processded-data","chapter":"8 Exploration of processded data","heading":"8 Exploration of processded data","text":"","code":""},{"path":"exploration-of-processded-data.html","id":"import-data","chapter":"8 Exploration of processded data","heading":"8.1 Import data","text":"","code":"\nlibrary(tidyverse)## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n## ✔ dplyr     1.1.4     ✔ readr     2.1.5\n## ✔ forcats   1.0.0     ✔ stringr   1.5.1\n## ✔ ggplot2   3.4.4     ✔ tibble    3.2.1\n## ✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n## ✔ purrr     1.0.2     \n## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n## ✖ dplyr::filter() masks stats::filter()\n## ✖ dplyr::lag()    masks stats::lag()\n## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\nlibrary(phyloseq)\nlibrary(microbiome)## \n## microbiome R package (microbiome.github.com)\n##     \n## \n## \n##  Copyright (C) 2011-2022 Leo Lahti, \n##     Sudarshan Shetty et al. <microbiome.github.io>\n## \n## \n## Attaching package: 'microbiome'\n## \n## The following object is masked from 'package:ggplot2':\n## \n##     alpha\n## \n## The following object is masked from 'package:base':\n## \n##     transform\nlibrary(microbiomeMarker)## Registered S3 method overwritten by 'gplots':\n##   method         from     \n##   reorder.factor DescTools\n## \n## Attaching package: 'microbiomeMarker'\n## \n## The following objects are masked from 'package:microbiome':\n## \n##     abundances, aggregate_taxa\n## \n## The following object is masked from 'package:phyloseq':\n## \n##     plot_heatmap\nload(\"../imap-data-preparation/data/external/external_ps_objects.rda\", verbose = TRUE)## Loading objects:\n##   df_GlobalPatterns\n##   df_ibd_phylo\n##   df_dietswap\n##   df_caporaso\n##   df_kostic_crc\n##   ps_GlobalPatterns\n##   ps_ibd_phylo\n##   ps_dietswap\n##   ps_caporaso\n##   ps_kostic_crc\nload(\"../imap-data-preparation/data/mothur/mothur_phyloseq_objects.rda\", verbose = TRUE)## Loading objects:\n##   mtps_metadata\n##   mtps_otutable\n##   mtps_taxonomy\n##   mtps_phylotree\n##   ps_tree\n##   ps_raw\n##   ps_rel\nload(\"../imap-data-preparation/data/qiime2/qiime2_phyloseq_objects.rda\", verbose = TRUE)## Loading objects:\n##   ps_tree\n##   ps_raw\n##   ps_rel\n##   ps_df_raw\n##   ps_df_rel"},{"path":"exploration-of-processded-data.html","id":"dataset-ps_globalpatterns","chapter":"8 Exploration of processded data","heading":"8.2 Dataset: ps_GlobalPatterns","text":"","code":"\nps_GlobalPatterns## phyloseq-class experiment-level object\n## otu_table()   OTU Table:         [ 19216 taxa and 26 samples ]\n## sample_data() Sample Data:       [ 26 samples by 7 sample variables ]\n## tax_table()   Taxonomy Table:    [ 19216 taxa by 7 taxonomic ranks ]\n## phy_tree()    Phylogenetic Tree: [ 19216 tips and 19215 internal nodes ]\ncat(\"\\nSample Variables\\n\")## \n## Sample Variables\nsample_variables(ps_GlobalPatterns)## [1] \"X.SampleID\"               \"Primer\"                  \n## [3] \"Final_Barcode\"            \"Barcode_truncated_plus_T\"\n## [5] \"Barcode_full_length\"      \"SampleType\"              \n## [7] \"Description\"\ncat(\"\\nNumber of levels in selected group\\n\")## \n## Number of levels in selected group\n1:length(unique(sample_data(ps_GlobalPatterns)$SampleType))## [1] 1 2 3 4 5 6 7 8 9"},{"path":"exploration-of-processded-data.html","id":"dataset-ps_ibd_phylo","chapter":"8 Exploration of processded data","heading":"8.3 Dataset: ps_ibd_phylo","text":"","code":"\nps_ibd_phylo## phyloseq-class experiment-level object\n## otu_table()   OTU Table:         [ 36349 taxa and 91 samples ]\n## sample_data() Sample Data:       [ 91 samples by 15 sample variables ]\n## tax_table()   Taxonomy Table:    [ 36349 taxa by 7 taxonomic ranks ]\ncat(\"\\nSample Variables\\n\")## \n## Sample Variables\nsample_variables(ps_ibd_phylo)##  [1] \"sample\"       \"gender\"       \"age\"          \"DiseaseState\" \"steroids\"    \n##  [6] \"imsp\"         \"abx\"          \"mesalamine\"   \"ibd\"          \"activity\"    \n## [11] \"active\"       \"race\"         \"fhx\"          \"imspLEVEL\"    \"SampleType\"\ncat(\"\\nNumber of levels in selected group\\n\")## \n## Number of levels in selected group\n1:length(unique(sample_data(ps_ibd_phylo)$DiseaseState))## [1] 1 2 3 4\nlibrary(microViz)\nps_ibd_phylo %>%\n  tax_fix() %>% \n  comp_barplot(\n    tax_level = \"Genus\", n_taxa = 15, other_name = \"Other\",\n    taxon_renamer = function(x) stringr::str_remove(x, \" [ae]t rel.\"),\n    palette = distinct_palette(n = 15, add = \"grey90\"),\n    merge_other = FALSE, bar_outline_colour = \"darkgrey\"\n  ) +\n  coord_flip() +\n  labs(x = NULL, y = NULL) +\n  theme(axis.text.y = element_blank(), axis.ticks.y = element_blank())"},{"path":"exploration-of-processded-data.html","id":"dataset-ps_dietswap","chapter":"8 Exploration of processded data","heading":"8.4 Dataset: ps_dietswap","text":"","code":"\nps_dietswap## phyloseq-class experiment-level object\n## otu_table()   OTU Table:         [ 130 taxa and 222 samples ]\n## sample_data() Sample Data:       [ 222 samples by 8 sample variables ]\n## tax_table()   Taxonomy Table:    [ 130 taxa by 3 taxonomic ranks ]\ncat(\"\\nSample Variables\\n\")## \n## Sample Variables\nsample_variables(ps_dietswap)## [1] \"subject\"                \"sex\"                    \"nationality\"           \n## [4] \"group\"                  \"sample\"                 \"timepoint\"             \n## [7] \"timepoint.within.group\" \"bmi_group\"\ncat(\"\\nNumber of levels in nationality\\n\")## \n## Number of levels in nationality\n1:length(unique(sample_data(ps_dietswap)$nationality))## [1] 1 2\ncat(\"\\nNumber of levels in group\\n\")## \n## Number of levels in group\n1:length(unique(sample_data(ps_dietswap)$group))## [1] 1 2 3\nrun_lefse(\n    ps_dietswap,\n    wilcoxon_cutoff = 0.001,\n    group = \"nationality\",\n    taxa_rank = \"Phylum\",\n    transform = \"log10\",\n    kw_cutoff = 0.01,\n    multigrp_strat = TRUE,\n    lda_cutoff = 2) %>% \n  plot_heatmap(group = \"nationality\", color = \"rainbow, 1:length(unique(df_dietswap$nationality))\")## Warning in transform_log10(otu): OTU table contains zeroes. Using log10(1 + x)\n## instead.\n\n## Warning in transform_log10(otu): OTU table contains zeroes. Using log10(1 + x)\n## instead.\nlibrary(microViz)\nps_dietswap %>%\n  comp_barplot(\n    tax_level = \"Genus\", n_taxa = 15, other_name = \"Other\",\n    taxon_renamer = function(x) stringr::str_remove(x, \" [ae]t rel.\"),\n    palette = distinct_palette(n = 15, add = \"grey90\"),\n    merge_other = FALSE, bar_outline_colour = \"darkgrey\"\n  ) +\n  coord_flip() +\n  facet_wrap(\"nationality\", nrow = 1, scales = \"free\") +\n  labs(x = NULL, y = NULL) +\n  theme(axis.text.y = element_blank(), axis.ticks.y = element_blank())\n# ## Recoding values in phyloseq object\n# data(\"dietswap\", package = \"microbiome\")\n# \n# # create a couple of numerical variables to use as constraints or conditions\n# dietswap <- dietswap %>%\n#   ps_mutate(\n#     weight = recode(bmi_group, obese = 3, overweight = 2, lean = 1),\n#     female = if_else(sex == \"female\", true = 1, false = 0),\n#     african = if_else(nationality == \"AFR\", true = 1, false = 0)\n#   )\n# # add a couple of missing values to show how microViz handles missing data\n# sample_data(dietswap)$african[c(3, 4)] <- NA"},{"path":"exploration-of-processded-data.html","id":"dataset-ps_caporaso","chapter":"8 Exploration of processded data","heading":"8.5 Dataset: ps_caporaso","text":"","code":"\nps_caporaso## phyloseq-class experiment-level object\n## otu_table()   OTU Table:         [ 3426 taxa and 34 samples ]\n## sample_data() Sample Data:       [ 34 samples by 8 sample variables ]\n## tax_table()   Taxonomy Table:    [ 3426 taxa by 7 taxonomic ranks ]\n## phy_tree()    Phylogenetic Tree: [ 3426 tips and 3424 internal nodes ]\ncat(\"\\nSample Variables\\n\")## \n## Sample Variables\nsample_variables(ps_caporaso)## [1] \"SampleType\"               \"Year\"                    \n## [3] \"Month\"                    \"Day\"                     \n## [5] \"Subject\"                  \"ReportedAntibioticUsage\" \n## [7] \"DaysSinceExperimentStart\" \"Description\"\ncat(\"\\nNumber of levels in selected group\\n\")## \n## Number of levels in selected group\n1:length(unique(df_caporaso$SampleType))## [1] 1 2 3 4\nps_caporaso <- ps_caporaso %>%  tax_fix()\n\nrun_lefse(\n    ps_caporaso, \n    wilcoxon_cutoff = 0.001,\n    group = \"SampleType\",\n    taxa_rank = \"Class\",\n    transform = \"log10p\",\n    kw_cutoff = 0.01,\n    multigrp_strat = TRUE,\n    lda_cutoff = 2) %>%\n  plot_heatmap(group = \"SampleType\", color = c(\"green\", \"red\", \"grey\", \"magenta\", \"orange\", \"pink\", \"yellow\"))\nlibrary(microViz)\nps_caporaso %>%\n  tax_fix() %>% \n  comp_barplot(\n    tax_level = \"Genus\", n_taxa = 15, other_name = \"Other\",\n    taxon_renamer = function(x) stringr::str_remove(x, \" [ae]t rel.\"),\n    palette = distinct_palette(n = 15, add = \"grey90\"),\n    merge_other = FALSE, bar_outline_colour = \"darkgrey\"\n  ) +\n  coord_flip() +\n  facet_wrap(\"SampleType\", nrow = 1, scales = \"free\") +\n  labs(x = NULL, y = NULL) +\n  theme(axis.text.y = element_blank(), axis.ticks.y = element_blank())\ndata(\"caporaso\")\ncaporaso_small <- phyloseq::subset_taxa(\n    caporaso,\n    Phylum %in% c(\"p__Firmicutes\")\n)\nmm_lefse <- run_lefse(\n    caporaso_small,\n    wilcoxon_cutoff = 0.0001,\n    group = \"SampleType\",\n    kw_cutoff = 0.01,\n    multigrp_strat = TRUE,\n    lda_cutoff = 4\n)\nplot_cladogram(mm_lefse, color = c(\"green\", \"red\", \"magenta\", \"yellow\"))"},{"path":"exploration-of-processded-data.html","id":"dataset-ps_kostic_crc","chapter":"8 Exploration of processded data","heading":"8.6 Dataset: ps_kostic_crc","text":"","code":"\nps_kostic_crc## phyloseq-class experiment-level object\n## otu_table()   OTU Table:         [ 2505 taxa and 177 samples ]\n## sample_data() Sample Data:       [ 177 samples by 71 sample variables ]\n## tax_table()   Taxonomy Table:    [ 2505 taxa by 7 taxonomic ranks ]\ncat(\"\\nSample Variables\\n\")## \n## Sample Variables\nsample_variables(ps_kostic_crc)##  [1] \"X.SampleID\"                    \"BarcodeSequence\"              \n##  [3] \"LinkerPrimerSequence\"          \"NECROSIS_PERCENT\"             \n##  [5] \"TARGET_SUBFRAGMENT\"            \"ASSIGNED_FROM_GEO\"            \n##  [7] \"EXPERIMENT_CENTER\"             \"TITLE\"                        \n##  [9] \"RUN_PREFIX\"                    \"AGE\"                          \n## [11] \"NORMAL_EQUIVALENT_PERCENT\"     \"FIBROBLAST_AND_VESSEL_PERCENT\"\n## [13] \"DEPTH\"                         \"TREATMENT\"                    \n## [15] \"AGE_AT_DIAGNOSIS\"              \"COMMON_NAME\"                  \n## [17] \"HOST_COMMON_NAME\"              \"BODY_SITE\"                    \n## [19] \"ELEVATION\"                     \"REPORTS_RECEIVED\"             \n## [21] \"CEA\"                           \"PCR_PRIMERS\"                  \n## [23] \"COLLECTION_DATE\"               \"ALTITUDE\"                     \n## [25] \"ENV_BIOME\"                     \"SEX\"                          \n## [27] \"PLATFORM\"                      \"RACE\"                         \n## [29] \"BSP_DIAGNOSIS\"                 \"STUDY_CENTER\"                 \n## [31] \"COUNTRY\"                       \"CHEMOTHERAPY\"                 \n## [33] \"YEAR_OF_DEATH\"                 \"ETHNICITY\"                    \n## [35] \"ANONYMIZED_NAME\"               \"TAXON_ID\"                     \n## [37] \"SAMPLE_CENTER\"                 \"SAMP_SIZE\"                    \n## [39] \"YEAR_OF_BIRTH\"                 \"ORIGINAL_DIAGNOSIS\"           \n## [41] \"AGE_UNIT\"                      \"STUDY_ID\"                     \n## [43] \"EXPERIMENT_DESIGN_DESCRIPTION\" \"Description_duplicate\"        \n## [45] \"DIAGNOSIS\"                     \"BODY_HABITAT\"                 \n## [47] \"SEQUENCING_METH\"               \"RUN_DATE\"                     \n## [49] \"HISTOLOGIC_GRADE\"              \"LONGITUDE\"                    \n## [51] \"ENV_MATTER\"                    \"TARGET_GENE\"                  \n## [53] \"ENV_FEATURE\"                   \"KEY_SEQ\"                      \n## [55] \"BODY_PRODUCT\"                  \"TUMOR_PERCENT\"                \n## [57] \"LIBRARY_CONSTRUCTION_PROTOCOL\" \"REGION\"                       \n## [59] \"RUN_CENTER\"                    \"TUMOR_TYPE\"                   \n## [61] \"BSP_NOTES\"                     \"RADIATION_THERAPY\"            \n## [63] \"INFLAMMATION_PERCENT\"          \"HOST_SUBJECT_ID\"              \n## [65] \"PC3\"                           \"LATITUDE\"                     \n## [67] \"OSH_DIAGNOSIS\"                 \"STAGE\"                        \n## [69] \"PRIMARY_DISEASE\"               \"HOST_TAXID\"                   \n## [71] \"Description\"\ncat(\"\\nNumber of levels in DIAGNOSIS\\n\")## \n## Number of levels in DIAGNOSIS\n1:length(unique(sample_data(ps_kostic_crc)$DIAGNOSIS))## [1] 1 2\nrun_lefse(\n    ps_kostic_crc,\n    wilcoxon_cutoff = 0.001,\n    group = \"DIAGNOSIS\",\n    taxa_rank = \"Class\",\n    transform = \"log10p\",\n    kw_cutoff = 0.01,\n    multigrp_strat = TRUE,\n    lda_cutoff = 2) %>% \n  plot_heatmap(group = \"DIAGNOSIS\")\nkostic_crc_small <- phyloseq::subset_taxa(\n    ps_kostic_crc,\n    Phylum %in% c(\"Firmicutes\")\n)\nmm_lefse <- run_lefse(\n    kostic_crc_small,\n    wilcoxon_cutoff = 0.01,\n    group = \"DIAGNOSIS\",\n    kw_cutoff = 0.01,\n    multigrp_strat = TRUE,\n    lda_cutoff = 4\n)\nplot_cladogram(mm_lefse, color = c(\"darkgreen\", \"red\"))\nhtmp <- ps_dietswap %>%\n  ps_mutate(nationality = as.character(nationality)) %>%\n  tax_transform(\"log2\", add = 1, chain = TRUE) %>%\n  comp_heatmap(\n    taxa = tax_top(ps_dietswap, n = 30), grid_col = NA, name = \"Log2p\",\n    taxon_renamer = function(x) stringr::str_remove(x, \" [ae]t rel.\"),\n    colors = heat_palette(palette = viridis::turbo(11)),\n    row_names_side = \"left\", row_dend_side = \"right\", sample_side = \"bottom\",\n    sample_anno = sampleAnnotation(\n      Nationality = anno_sample_cat(\n        var = \"nationality\", col = c(AAM = \"grey35\", AFR = \"grey85\"),\n        box_col = NA, legend_title = \"Nationality\", size = grid::unit(4, \"mm\")\n      )\n    )\n  )\n\nComplexHeatmap::draw(\n  object = htmp, annotation_legend_list = attr(htmp, \"AnnoLegends\"),\n  merge_legends = TRUE\n)\n# perform ordination\nunconstrained_aitchison_pca <- ps_dietswap %>%\n  tax_filter(min_prevalence = 0.1, tax_level = \"Genus\") %>%\n  tax_agg(\"Family\") %>%\n  tax_transform(\"clr\") %>%\n  ord_calc()## Proportional min_prevalence given: 0.1 --> min 23/222 samples.\n#> Proportional min_prevalence given: 0.1 --> min 23/222 samples.\n# ord_calc will automatically infer you want a \"PCA\" here\n# specify explicitly with method = \"PCA\", or you can pick another method\n\n# create plot\npca_plot <- unconstrained_aitchison_pca %>%\n  ord_plot(\n    plot_taxa = 1:6, colour = \"bmi_group\", size = 1.5,\n    tax_vec_length = 0.325,\n    tax_lab_style = tax_lab_style(max_angle = 90, aspect_ratio = 0.5),\n    auto_caption = 8\n  )\n\n# customise plot\ncustomised_plot <- pca_plot +\n  stat_ellipse(aes(linetype = bmi_group, colour = bmi_group), linewidth = 0.3) + # linewidth not size, since ggplot 3.4.0\n  scale_colour_brewer(palette = \"Set1\") +\n  theme(legend.position = \"bottom\") +\n  coord_fixed(ratio = 0.5, clip = \"off\") # makes rotated labels align correctly\n\n# show plot\ncustomised_plot\n# Test for significance\n# calculate distances\naitchison_dists <- ps_dietswap %>%\n  tax_filter(min_prevalence = 0.1) %>%\n  tax_transform(\"identity\", rank = \"Family\") %>%\n  dist_calc(\"aitchison\")## Proportional min_prevalence given: 0.1 --> min 23/222 samples.\n#> Proportional min_prevalence given: 0.1 --> min 23/222 samples.\n\n# the more permutations you request, the longer it takes\n# but also the more stable and precise your p-values become\naitchison_perm <- aitchison_dists %>%\n  dist_permanova(\n    seed = 1234, # for set.seed to ensure reproducibility of random process\n    n_processes = 1, n_perms = 99, # you should use at least 999!\n    variables = \"bmi_group\"\n  )## 2024-02-21 23:27:19.337993 - Starting PERMANOVA with 99 perms with 1 processes## 2024-02-21 23:27:19.392805 - Finished PERMANOVA\n#> 2023-04-03 15:50:14 - Starting PERMANOVA with 99 perms with 1 processes\n#> 2023-04-03 15:50:14 - Finished PERMANOVA\n\n# view the permanova results\nperm_get(aitchison_perm) %>% as.data.frame()##            Df  SumOfSqs         R2        F Pr(>F)\n## bmi_group   2  104.0678 0.04177157 4.773379   0.01\n## Residual  219 2387.2862 0.95822843       NA     NA\n## Total     221 2491.3540 1.00000000       NA     NA\n#>            Df  SumOfSqs         R2        F Pr(>F)\n#> bmi_group   2  104.0678 0.04177157 4.773379   0.01\n#> Residual  219 2387.2862 0.95822843       NA     NA\n#> Total     221 2491.3540 1.00000000       NA     NA\n\n# view the info stored about the distance calculation\ninfo_get(aitchison_perm)## psExtra info:\n## tax_agg = \"Family\" tax_trans = \"identity\" dist_method = \"aitchison\"\n#> psExtra info:\n#> tax_agg = \"Family\" tax_trans = \"identity\" dist_method = \"aitchison\"\n# perm2 <- aitchison_dists %>%\n#   dist_permanova(variables = c(\"weight\", \"african\", \"sex\"), seed = 321)\n# \n# perm2 %>%\n#   ord_calc(constraints = c(\"weight\", \"african\"), conditions = \"female\") %>%\n#   ord_plot(\n#     colour = \"nationality\", size = 2.5, alpha = 0.35,\n#     auto_caption = 7,\n#     constraint_vec_length = 1,\n#     constraint_vec_style = vec_constraint(1.5, colour = \"grey15\"),\n#     constraint_lab_style = constraint_lab_style(\n#       max_angle = 90, size = 3, aspect_ratio = 0.35, colour = \"black\"\n#     )\n#   ) +\n#   stat_ellipse(aes(colour = nationality), linewidth = 0.2) + # linewidth not size since ggplot 3.4.0\n#   scale_color_brewer(palette = \"Set1\") +\n#   coord_fixed(ratio = 0.35, clip = \"off\") +\n#   theme(legend.position = c(0.9, 0.1), legend.background = element_rect())\n#Correlation heatmap\n# set up the data with numerical variables and filter to top taxa\npsq <- ps_dietswap %>%\n  ps_mutate(\n    weight = recode(bmi_group, obese = 3, overweight = 2, lean = 1),\n    female = if_else(sex == \"female\", true = 1, false = 0),\n    african = if_else(nationality == \"AFR\", true = 1, false = 0)\n  ) %>%\n  tax_filter(\n    tax_level = \"Genus\", min_prevalence = 1 / 10, min_sample_abundance = 1 / 10\n  ) %>%\n  tax_transform(\"identity\", rank = \"Genus\")## Proportional min_prevalence given: 0.1 --> min 23/222 samples.\n#> Proportional min_prevalence given: 0.1 --> min 23/222 samples.\n\n# randomly select 30 taxa from the 50 most abundant taxa (just for an example)\nset.seed(123)\ntaxa <- sample(tax_top(psq, n = 50), size = 30)\n# actually draw the heatmap\ncor_heatmap(\n  data = psq, taxa = taxa,\n  taxon_renamer = function(x) stringr::str_remove(x, \" [ae]t rel.\"),\n  tax_anno = taxAnnotation(\n    Prev. = anno_tax_prev(undetected = 50),\n    Log2 = anno_tax_box(undetected = 50, trans = \"log2\", zero_replace = 1)\n  )\n)"},{"path":"exploration-of-processded-data.html","id":"plot-ggtree-cladogram","chapter":"8 Exploration of processded data","heading":"8.7 Plot ggtree cladogram","text":"","code":"\n# library(ggtree)\n\n# ggtree(\n#   ps_tree,\n#   mapping = NULL,\n#   layout = \"circular\",\n#   open.angle = 0,\n#   mrsd = NULL,\n#   as.Date = FALSE,\n#   yscale = \"none\",\n#   yscale_mapping = NULL,\n#   ladderize = TRUE,\n#   right = FALSE,\n#   branch.length = \"branch.length\",\n#   root.position = 0,\n#   xlim = NULL\n# )\n# External data\nload(\"~/Dropbox/MICROBIOME/imap-data-processing/data/external/external_ps_objects.rda\", verbose = TRUE)## Loading objects:\n##   df_GlobalPatterns\n##   df_ibd_phylo\n##   df_dietswap\n##   df_caporaso\n##   df_kostic_crc\n##   ps_GlobalPatterns\n##   ps_ibd_phylo\n##   ps_dietswap\n##   ps_caporaso\n##   ps_kostic_crc\nlibrary(tidyverse)\nlibrary(vegan)## Loading required package: permute## Loading required package: lattice## This is vegan 2.6-4## \n## Attaching package: 'vegan'## The following object is masked from 'package:microbiome':\n## \n##     diversity\n# # Mothur\n# load(\"~/Dropbox/MICROBIOME/imap-data-processing/data/mothur/mothur_phyloseq_objects.rda\", verbose = TRUE)\n# composite <- read_csv(\"~/Dropbox/MICROBIOME/imap-data-processing/data/mothur/mothur_composite.csv\", show_col_types = FALSE)\n  # separate(Sample, into = c(\"animal\", \"day\"), sep = \"D\", remove = FALSE, convert = TRUE) %>%\nset.seed(123)\n\n# taxa <- sample(tax_top(ps_dietswap, n = 30), size = 20)"},{"path":"exploration-of-processded-data.html","id":"getting-otutable-from-phyloseq","chapter":"8 Exploration of processded data","heading":"8.8 Getting otutable from phyloseq","text":"","code":"\nlibrary(tidyverse)\nlibrary(vegan)\nlibrary(phyloseq)\n\nps <- ps_dietswap\n\notutable <- otu_table(ps) %>% \n  psmelt() %>% \n  group_by(Sample) %>%\n  mutate(N = sum(Abundance)) %>%\n  ungroup() %>% \n  # filter(N >= min(otutable$N)) %>%\n  select(-N) %>% \n  pivot_wider(names_from=\"OTU\", values_from=\"Abundance\", values_fill=0) %>%\n  column_to_rownames(\"Sample\")"},{"path":"exploration-of-processded-data.html","id":"getting-bray-curtis-distances","chapter":"8 Exploration of processded data","heading":"8.9 Getting Bray-Curtis distances","text":"","code":"\nbray <- avgdist(otutable, dmethod=\"bray\", sample=1776) %>%\n  as.matrix() %>%\n  as_tibble(rownames = \"A\") %>%\n  pivot_longer(-A, names_to=\"B\", values_to=\"distances\")\n\nbray %>%\n  ggplot(aes(x=A, y=B, fill=distances)) +\n  geom_tile()"},{"path":"exploration-of-processded-data.html","id":"getting-jaccard-distances","chapter":"8 Exploration of processded data","heading":"8.10 Getting Jaccard distances","text":"","code":"\njaccard <- avgdist(otutable, dmethod=\"jaccard\", sample=1776) %>%\n  as.matrix() %>%\n  as_tibble(rownames = \"A\") %>%\n  pivot_longer(-A, names_to=\"B\", values_to=\"distances\")\n\njaccard %>%\n  ggplot(aes(x=A, y=B, fill=distances)) +\n  geom_tile()\n## Some params\n\nlabels <- tibble(\n  x=c(50, 190),\n  y=c(190, 30),\n  label=c(\"Bray-Curtis\", \"Jaccard\")\n)\n\ninner_join(bray, jaccard, by=c(\"A\", \"B\")) %>%\n  select(A, B, bray=distances.x, jaccard=distances.y) %>%\n  mutate(distances = if_else(A < B, bray, jaccard)) %>%\n  # mutate(A = fct_reorder(as.character(A), A),\n  #        B = fct_reorder(as.character(B), B)) %>%\n  ggplot(aes(x=A, y=B, fill=distances)) +\n  geom_tile() +\n  geom_text(data=labels, aes(x=(x), y=y, label=label), inherit.aes=FALSE,\n            size=10) +\n  scale_fill_gradient(low=\"#FF0000\", high=\"#FFFFFF\", name=NULL) +\n  labs(x=\"\", y=\"\") +\n  theme_classic() +\n  theme(axis.line=element_blank(),\n        axis.ticks = element_blank(),\n        axis.text = element_text(size=8),\n        axis.text.y = element_text(hjust= 0.5),\n        axis.text.x = element_text(angle = 90, size = 6))"},{"path":"imap-github-repos.html","id":"imap-github-repos","chapter":"A IMAP GitHub Repos","heading":"A IMAP GitHub Repos","text":"","code":""},{"path":"data-exploration-rulegraph.html","id":"data-exploration-rulegraph","chapter":"B Data Exploration Rulegraph","heading":"B Data Exploration Rulegraph","text":"","code":""},{"path":"session-information.html","id":"session-information","chapter":"C Session Information","heading":"C Session Information","text":"Reproducibility relies ability precisely recreate working environment, session information serves vital reference achieve consistency. record details R environment, package versions, system settings computing environment time analysis.","code":"\nlibrary(knitr)\nlibrary(sessioninfo)\n\n# Get session info\ninfo <- capture.output(print(session_info()))\n\n# Create the 'resources' folder if it doesn't exist\nif (!dir.exists(\"resources\")) {\n  dir.create(\"resources\")\n}\n\n# Save the session information to a text file without line numbers\ncat(info, file = \"session_info.txt\", sep = \"\\n\")"},{"path":"references.html","id":"references","chapter":"References","heading":"References","text":"Last updated February 21, 2024.\nGithub_Repo: https://github.com/datainsights/imap-project-overview\nRepo compiled maintained : Teresia Mrema-Buza.\nrelated info, visit CDI website (…progress).","code":""}]
