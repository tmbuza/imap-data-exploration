[{"path":"index.html","id":"data-exploration","chapter":"IMAP-Part 08: Microbiome Data Exploration Guide","heading":"IMAP-Part 08: Microbiome Data Exploration Guide","text":"","code":""},{"path":"index.html","id":"welcome-to-chapter-8","chapter":"IMAP-Part 08: Microbiome Data Exploration Guide","heading":"Welcome to chapter 8","text":"Welcome Microbiome Data Exploration section! phase analysis, embark journey explore intricacies microbiome data using preprocessed data stored phyloseq objects. objects encapsulate rich information microbial communities, including taxonomic abundance, sample metadata, ecological features.data exploration, aim unravel hidden patterns, structures, relationships within microbial communities, shedding light composition, diversity, ecological dynamics. delving depths microbiome data, strive uncover novel insights understand complex interplay microorganisms environments.Throughout exploration, ’ll employ various analytical techniques, visualization methods, statistical approaches gain comprehensive understanding microbial communities’ structure function.Let’s embark exciting exploration together!","code":""},{"path":"preface.html","id":"preface","chapter":"1 Exploratory Data Analysis (EDA) of Microbiome Communities","heading":"1 Exploratory Data Analysis (EDA) of Microbiome Communities","text":"chapter, shift focus meticulous data preparation process dynamic enlightening stage “Data Exploration.” microbiome data refined optimized, exploration phase becomes pivotal step research journey. preface sets stage exploration, addressing novice researcher seeking fundamental insights seasoned analyst eager uncover intricate patterns within microbial communities.","code":""},{"path":"preface.html","id":"the-significance-of-data-exploration","chapter":"1 Exploratory Data Analysis (EDA) of Microbiome Communities","heading":"1.1 The Significance of Data Exploration","text":"Data exploration represents pivotal phase data analysis pipeline. ’s researchers delve dataset, deciphering structure, spotting patterns, formulating hypotheses. Beyond basic summary statistics, phase delves visual representation, hypothesis testing, uncovering trends, can inform subsequent analyses.","code":""},{"path":"preface.html","id":"what-to-expect","chapter":"1 Exploratory Data Analysis (EDA) of Microbiome Communities","heading":"1.2 What to Expect","text":"following pages, offer comprehensive guide data exploration techniques tailored explicitly microbiome datasets. Covering everything foundational concepts advanced visualizations, chapter spans spectrum approaches. Whether ’re embarking first exploration seeking augment analytical toolkit, guide provides step--step instructions, best practices, practical insights.","code":""},{"path":"preface.html","id":"navigating-the-chapter","chapter":"1 Exploratory Data Analysis (EDA) of Microbiome Communities","heading":"1.3 Navigating the Chapter","text":"chapter unfolds logically, starting basic exploratory techniques advancing complex methods. section builds upon last, offering coherent structured approach comprehending interpreting microbiome data. progress, expect encounter code snippets, visualizations, real-world examples illustrating effective data exploration principles.","code":""},{"path":"preface.html","id":"embark-on-the-exploration","chapter":"1 Exploratory Data Analysis (EDA) of Microbiome Communities","heading":"1.4 Embark on the Exploration","text":"Data exploration merely technical pursuit; ’s voyage discovery. delve chapter, embrace iterative nature exploration, allowing curiosity guide analyses. Insights gleaned lay groundwork targeted investigations, enriching understanding microbial communities scrutiny.Whether ’re newcomer data exploration seasoned analyst datasets, chapter beckons explore intricate complexities microbiome data. Let journey begin!","code":""},{"path":"demo-datasets.html","id":"demo-datasets","chapter":"2 Microbiome Demo Datasets","heading":"2 Microbiome Demo Datasets","text":"section, provide demo datasets microbiome analysis. datasets preprocessed transformed previous sessions, now preparing analyze . begin importing R Phyloseq objects.","code":""},{"path":"demo-datasets.html","id":"import-preprepared-data","chapter":"2 Microbiome Demo Datasets","heading":"2.1 Import preprepared data","text":"\ndemo data QIIME2 analysis downloaded stored \ndata/qiime2 directory. can use files practice\nQIIME2 workflows analysis techniques.\n\ndata sourced QIIME2 tutorials available https://docs.qiime2.org/2024.4/data/tutorials/moving-pictures/.\n\ncontains following files:\n\nSample metadata\n\nFeature table\n\nTaxonomy\n\nShannon vector\n\nRooted tree\n\ndata essential leveraging downstream analysis aimed \nunderstanding data analyzed using QIIME2 pipeline.\n\n```R (!dir.exists(“data”)){dir.create(“data”)} \n(!dir.exists(“data/qiime2”)){dir.create(“data/qiime2”)}\n\ndownload.file(“https://docs.qiime2.org/2024.2/data/tutorials/moving-pictures/table.qza”,\n“data/qiime2/feature_table.qza”)\ndownload.file(“https://data.qiime2.org/2024.2/tutorials/moving-pictures/sample_metadata.tsv”,\n“data/qiime2/sample_metadata.tsv”)\ndownload.file(“https://docs.qiime2.org/2024.2/data/tutorials/moving-pictures/taxonomy.qza”,\n“data/qiime2/taxonomy.qza”)\ndownload.file(“https://docs.qiime2.org/2024.2/data/tutorials/moving-pictures/rooted-tree.qza”,\n“data/qiime2/rooted_tree.qza”)\ndownload.file(“https://docs.qiime2.org/2024.2/data/tutorials/moving-pictures/core-metrics-results/shannon_vector.qza”,\n“data/qiime2/shannon_vector.qza”)\n","code":"\n# Load required packages\nlibrary(phyloseq)\nlibrary(tidyverse)\n\ncat(\"\\nSaved RData objects\\n\\n\")\nSaved RData objects\nload(\"data/ps_transformed.rda\", verbose = T)Loading objects:\n  ps_asin\n  ps_identity\n  ps_compositional\n  ps_z_otu\n  ps_z_sample\n  ps_log10\n  ps_log10p\n  ps_clr\n  ps_shift\n  ps_scale\nload(\"data/bray_distances.rda\", verbose = T)Loading objects:\n  ps_asin_bray_dist\n  ps_compositional_bray_dist\n  ps_z_otu_bray_dist\n  ps_z_sample_bray_dist\n  ps_log10_bray_dist\n  ps_log10p_bray_dist\n  ps_clr_bray_dist\n  ps_shift_bray_dist\n  ps_scale_bray_dist\nload(\"data/reduced_dimension.rda\", verbose = T)Loading objects:\n  pca_asin_bray_metrics\n  mds_asin_bray_metrics\n  pcoa_asin_bray_metrics\n  tsne_asin_bray_metrics\nload(\"data/phyloseq_raw_rel_psextra_df_objects.rda\", verbose = T)Loading objects:\n  ps_raw\n  ps_rel\n  psextra_raw\n  psextra_rel\n  ps_df"},{"path":"exploration-of-visualization-types.html","id":"exploration-of-visualization-types","chapter":"3 Exploration of Visualization Types","heading":"3 Exploration of Visualization Types","text":"","code":""},{"path":"exploration-of-visualization-types.html","id":"import-data","chapter":"3 Exploration of Visualization Types","heading":"3.1 Import data","text":"","code":"\n# Load required packages\nlibrary(phyloseq)\nlibrary(tidyverse)\n\ncat(\"\\nSaved RData objects\\n\\n\")\nSaved RData objects\nload(\"data/external_ps_objects.rda\", verbose = T)Loading objects:\n  df_GlobalPatterns\n  df_dietswap\n  df_caporaso\n  df_kostic_crc\n  ps_GlobalPatterns\n  ps_dietswap\n  ps_caporaso\n  ps_kostic_crc\nload(\"data/ps_transformed.rda\", verbose = T)Loading objects:\n  ps_asin\n  ps_identity\n  ps_compositional\n  ps_z_otu\n  ps_z_sample\n  ps_log10\n  ps_log10p\n  ps_clr\n  ps_shift\n  ps_scale\nload(\"data/bray_distances.rda\", verbose = T)Loading objects:\n  ps_asin_bray_dist\n  ps_compositional_bray_dist\n  ps_z_otu_bray_dist\n  ps_z_sample_bray_dist\n  ps_log10_bray_dist\n  ps_log10p_bray_dist\n  ps_clr_bray_dist\n  ps_shift_bray_dist\n  ps_scale_bray_dist\nload(\"data/psextra_distances.rda\", verbose = T)Loading objects:\n  psextra_clr_asin_bray_dist\n  psextra_id_asin_bray_dist\n  psextra_log10p_asin_bray_dist\nload(\"data/reduced_dimension.rda\", verbose = T)Loading objects:\n  pca_asin_bray_metrics\n  mds_asin_bray_metrics\n  pcoa_asin_bray_metrics\n  tsne_asin_bray_metrics\nload(\"data/phyloseq_extra_objects.rda\", verbose = T)Loading objects:\n  psextra_clr_dietswap\n  psextra_id_dietswap\n  psextra_log10p_dietswap\nload(\"data/phyloseq_raw_rel_psextra_df_objects.rda\", verbose = T)Loading objects:\n  ps_raw\n  ps_rel\n  psextra_raw\n  psextra_rel\n  ps_df"},{"path":"exploration-of-visualization-types.html","id":"major-visualization-r-colors","chapter":"3 Exploration of Visualization Types","heading":"3.2 Major visualization R colors","text":"R, several built-palettes can use color schemes plots. commonly used palettes include:viridis: perceptually uniform colorblind-friendly palette.viridis: perceptually uniform colorblind-friendly palette.magma: palette dark--light color scheme.magma: palette dark--light color scheme.inferno: palette light--dark color scheme.inferno: palette light--dark color scheme.plasma: palette dark--light color scheme.plasma: palette dark--light color scheme.cool: palette cool colors.cool: palette cool colors.hot: palette hot colors.hot: palette hot colors.terrain.colors: palette colors resembling terrain map.terrain.colors: palette colors resembling terrain map.rainbow: palette colors rainbow.rainbow: palette colors rainbow.heat.colors: palette colors ranging dark red yellow.heat.colors: palette colors ranging dark red yellow.ggpubr: “npg”, “aaas”, “lancet”, “jco”, “ucscgb”, “uchicago”, “simpsons” “rickandmorty”.ggpubr: “npg”, “aaas”, “lancet”, “jco”, “ucscgb”, “uchicago”, “simpsons” “rickandmorty”.","code":"[1] \"#66C2A5\" \"#FC8D62\" \"#8DA0CB\" \"#E78AC3\" \"#A6D854\" \"#FFD92F\" \"#E5C494\"\n[8] \"#B3B3B3\"[1] \"#B3B3B3\" \"#E5C494\" \"#FFD92F\" \"#A6D854\" \"#E78AC3\" \"#8DA0CB\" \"#FC8D62\"\n[8] \"#66C2A5\"[1] \"#440154FF\" \"#46337EFF\" \"#365C8DFF\" \"#277F8EFF\" \"#1FA187FF\" \"#4AC16DFF\"\n[7] \"#9FDA3AFF\" \"#FDE725FF\"[1] \"#FDE725FF\" \"#9FDA3AFF\" \"#4AC16DFF\" \"#1FA187FF\" \"#277F8EFF\" \"#365C8DFF\"\n[7] \"#46337EFF\" \"#440154FF\"[1] \"#FF0000\" \"#FFBF00\" \"#80FF00\" \"#00FF40\" \"#00FFFF\" \"#0040FF\" \"#8000FF\"\n[8] \"#FF00BF\"[1] \"#FF00BF\" \"#8000FF\" \"#0040FF\" \"#00FFFF\" \"#00FF40\" \"#80FF00\" \"#FFBF00\"\n[8] \"#FF0000\""},{"path":"exploration-of-visualization-types.html","id":"visual-types","chapter":"3 Exploration of Visualization Types","heading":"3.3 Major visualization techniques","text":"key visualization techniques used microbiome research, along descriptions corresponding tools R.","code":""},{"path":"bar-plots.html","id":"bar-plots","chapter":"4 Bar Plots","heading":"4 Bar Plots","text":"Bar plots commonly used visualize relative abundance taxa features within different groups conditions microbiome data. section, demonstrate different methods plotting bar plots.","code":""},{"path":"bar-plots.html","id":"explore-categorical-variables","chapter":"4 Bar Plots","heading":"4.1 Explore categorical variables","text":"freq() function funModeling package provides concise summary frequency distribution categorical variable dataset. displays count percentage category, allowing users quickly understand distribution prevalence different categories within variable. function useful exploratory data analysis understanding composition categorical variables dataset.","code":"\nlibrary(phyloseq)\nlibrary(dplyr)\nlibrary(microbiome)\nlibrary(funModeling)\n\ndf <-ps_df %>% \n  select(-sample_id) %>% \n  rename_all(tolower)\n\nfreq(df, \n     input = c(\"sex\", \"nationality\", \"grp\", \"bmi\"), \n     plot = TRUE,\n     na.rm = FALSE, \n     # path_out=\"figures\"\n     )     sex frequency percentage cumulative_perc\n1   male     49604      54.09           54.09\n2 female     42096      45.91          100.00  nationality frequency percentage cumulative_perc\n1         AAM     50468      55.04           55.04\n2         AFR     41232      44.96          100.00  grp frequency percentage cumulative_perc\n1  ED     31080      33.89           33.89\n2  HE     31068      33.88           67.77\n3  DI     29552      32.23          100.00         bmi frequency percentage cumulative_perc\n1      obese     37080      40.44           40.44\n2 overweight     31320      34.15           74.59\n3       lean     23300      25.41          100.00[1] \"Variables processed: sex, nationality, grp, bmi\""},{"path":"bar-plots.html","id":"compute-sequence-count-per-sample","chapter":"4 Bar Plots","heading":"4.2 Compute sequence count per sample","text":"show head tail count data","code":"\nseqcount_per_sample <- ps_df %>%\n  group_by(sample_id) %>% \n  summarise(nseqs = sum(count), .groups = \"drop\") %>% \n  arrange(-nseqs)\n\nhead_tail <- rbind(head(seqcount_per_sample, 5), tail(seqcount_per_sample, 5))\n\nmax_y <- max(head_tail$nseqs)\n\nhead_tail %>% \n  mutate(sample_id = factor(sample_id),\n         sample_id = fct_reorder(sample_id, nseqs, .desc = F),\n         sample_id = fct_shift(sample_id, n = 0)) %>%\n  ggplot(aes(x = reorder(sample_id, nseqs), y = nseqs)) +\n  geom_col(position = position_stack(), fill = \"steelblue\") +\n  labs(x = \"sample ID\", y = \"Number of sequences\", subtitle = \"Phylum: Top and bottom sequence count \\nwith no data labels\") +\n  theme_classic() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8))\nggsave(\"figures/basic_barplot.png\", width=5, height=4)\n\n\n#---------------------------------------\n\n\nhead_tail %>% \n  mutate(sample_id = factor(sample_id),\n         sample_id = fct_reorder(sample_id, nseqs, .desc = F),\n         sample_id = fct_shift(sample_id, n = 0)) %>%\n  ggplot(aes(x = reorder(sample_id, nseqs), y = nseqs)) +\n  geom_col(position = position_stack(), fill = \"steelblue\") +\n  labs(x = \"sample ID\", y = \"Number of sequences\", subtitle = \"Phylum: Top and bottom sequence count \\nwith data labels\") +\n  theme_classic() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8)) +\n  coord_cartesian(ylim = c(0, max_y)) +\n  geom_text(aes(label = nseqs), vjust = -0.3, color = \"#AAAAAA\")\nggsave(\"figures/barplot_w_labels.png\", width=5, height=4)"},{"path":"bar-plots.html","id":"relative-abundance-of-taxa","chapter":"4 Bar Plots","heading":"4.3 Relative abundance of taxa","text":"comp_barplot function microViz R package designed create comparative bar plots visualizing microbiome data. function allows users compare relative abundance taxa features across different groups conditions. supports customization options color palette selection plot title specification enhance appearance bar plot.","code":"\nlibrary(microViz)\n\npsextra_raw %>%\n  comp_barplot(\n    tax_level = \"Genus\", n_taxa = 15, other_name = \"Other\",\n    taxon_renamer = function(x) stringr::str_remove(x, \" [ae]t rel.\"),\n    palette = distinct_palette(n = 15, add = \"grey90\"),\n    merge_other = FALSE, bar_outline_colour = \"darkgrey\"\n  ) +\n  coord_flip() +\n  facet_wrap(\"nationality\", nrow = 1, scales = \"free\") +\n  labs(x = NULL, y = NULL) +\n  theme(axis.text.y = element_blank(), axis.ticks.y = element_blank())"},{"path":"bar-plots.html","id":"bar-plot-on-ps_caporaso-dataset","chapter":"4 Bar Plots","heading":"4.4 Bar plot on ps_caporaso dataset","text":"","code":"\nlibrary(microViz)\n\nps_caporaso %>%\n  tax_fix() %>% \n  comp_barplot(\n    tax_level = \"Genus\", n_taxa = 15, other_name = \"Other\",\n    taxon_renamer = function(x) stringr::str_remove(x, \" [ae]t rel.\"),\n    palette = distinct_palette(n = 15, add = \"grey90\"),\n    merge_other = FALSE, bar_outline_colour = \"darkgrey\"\n  ) +\n  coord_flip() +\n  # facet_wrap(\"SampleType\", nrow = 1, scales = \"free\") +\n  labs(x = NULL, y = NULL) +\n  theme(axis.text.y = element_blank(), axis.ticks.y = element_blank())"},{"path":"bar-plots.html","id":"bar-plots-for-taxa-relative-abundane","chapter":"4 Bar Plots","heading":"4.5 Bar plots for Taxa relative abundane","text":"","code":"\nset.seed(1234)\nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(ggtext)\nlibrary(RColorBrewer)\n\n\n\notu_rel_abund <- ps_df %>%\n  mutate(nationality = factor(nationality, \n                      levels = c(\"AAM\", \"AFR\"),\n                      labels = c(\"African American\", \"African\")),\n         bmi = factor(bmi,\n                      levels = c(\"lean\", \"overweight\", \"obese\"),\n                      labels = c(\"Lean\", \"Overweight\", \"Obese\")),\n         sex = factor(sex,\n                      levels =c(\"female\", \"male\"),\n                      labels = c(\"Female\", \"Male\")))\n\nsave(otu_rel_abund, file = \"data/otu_rel_abund.rda\")\n\nphylum_rel_abund <- otu_rel_abund %>%\n  filter(level==\"phylum\",\n         !grepl(\".*unassigned.*|.*nclassified.*|.*ncultured.*\",taxon)) %>%\n  group_by(bmi, sample_id, taxon) %>%\n  summarise(rel_abund = sum(rel_abund), .groups=\"drop\") %>%\n  group_by(bmi, taxon) %>%\n  summarise(mean_rel_abund = 100*mean(rel_abund), .groups=\"drop\") %>%\n  mutate(taxon = str_replace(taxon, \"(.*)_unclassified\", \"Unclassified<br>*\\\\1*\"),\n         taxon = str_replace(taxon, \"^$\", \"*\\\\1*\"),\n         taxon = str_replace(taxon, \"_\", \" \"))\n\n## Pool low abundance to \"Others\"\ntaxon_pool <- phylum_rel_abund %>%\n  group_by(taxon) %>%\n  summarise(pool = max(mean_rel_abund) < 1,\n            mean = mean(mean_rel_abund), .groups=\"drop\")\n\n\ninner_join(phylum_rel_abund, taxon_pool, by=\"taxon\") %>%\n  mutate(taxon = if_else(pool, \"Other\", taxon)) %>%\n  group_by(bmi, taxon) %>%\n  summarise(mean_rel_abund = sum(mean_rel_abund),\n            mean = min(mean), .groups=\"drop\") %>%\n  mutate(taxon = factor(taxon),\n         taxon = fct_reorder(taxon, mean, .desc=TRUE),\n         taxon = fct_shift(taxon, n=1)) %>%\n  ggplot(aes(x=bmi, y=mean_rel_abund, fill=taxon)) +\n  geom_col(position = position_stack()) +\n  scale_fill_discrete(name=NULL) +\n  scale_x_discrete(breaks = c(\"lean\", \"overweight\", \"obese\"), labels = c(\"Lean\", \"Overweight\", \"Obese\")) +\n  scale_fill_manual(name=NULL,\n                    breaks=c(\"*Actinobacteria*\",\"*Bacteroidetes*\", \"*Cyanobacteria*\", \"*Firmicutes*\",\"*Proteobacteria*\", \"Other\"),\n                    labels = c(\"Actinobacteria\",\"Bacteroidetes\", \"Cyanobacteria\", \"Firmicutes\", \"Proteobacteria\", \"Other\"),\n                    values = c(brewer.pal(5, \"Dark2\"), \"gray\")) +\n  labs(x = NULL, y = \"Mean Relative Abundance\", subtitle = \"Phyla stacked bars filled by taxon\") +\n  theme_classic() +\n  theme(axis.text.x = element_markdown(),\n        legend.text = element_markdown(),\n        legend.key.size = unit(10, \"pt\"))\nggsave(\"figures/stacked_phyla.png\", width=5, height=4)\n#---------------------------------------\n\ntaxon_rel_abund <- otu_rel_abund %>%\n  filter(level==\"genus\",\n         !grepl(\".*unassigned.*|.*nclassified.*|.*ncultured.*\",taxon)) %>%\n  group_by(bmi, sample_id, taxon) %>%\n  summarise(rel_abund = sum(rel_abund), .groups=\"drop\") %>%\n  group_by(bmi, taxon) %>%\n  summarise(mean_rel_abund = 100*mean(rel_abund), .groups=\"drop\") %>%\n  mutate(taxon = str_replace(taxon, \"(.*)_unclassified\", \"Unclassified<br>*\\\\1*\"),\n         taxon = str_replace(taxon, \"^$\", \"*\\\\1*\"),\n         taxon = str_replace(taxon, \"_\", \" \"))\n\n#---------------------------------------\n\n## Pool low abundance to \"Others\"\n\ntaxon_pool <- taxon_rel_abund %>%\n  group_by(taxon) %>%\n  summarise(pool = max(mean_rel_abund) < 2,\n            mean = mean(mean_rel_abund), .groups=\"drop\")\n\n\ninner_join(taxon_rel_abund, taxon_pool, by=\"taxon\") %>%\n  mutate(taxon = if_else(pool, \"Other\", taxon)) %>%\n  group_by(bmi, taxon) %>%\n  summarise(mean_rel_abund = sum(mean_rel_abund),\n            mean = min(mean), .groups=\"drop\") %>%\n  mutate(taxon = factor(taxon),\n         taxon = fct_reorder(taxon, mean, .desc=TRUE),\n         taxon = fct_shift(taxon, n=1)) %>%\n  ggplot(aes(x=bmi, y=mean_rel_abund, fill=taxon)) +\n  geom_col(position = position_stack()) +\n  scale_fill_discrete(name=NULL) +\n  scale_x_discrete(breaks = c(\"lean\", \"overweight\", \"obese\"), labels = c(\"Lean\", \"Overweight\", \"Obese\")) +\n  labs(x = NULL, y = \"Mean Relative Abundance\", subtitle = \"Taxa stacked bars filled by taxon\") +\n  theme_classic() +\n  theme(axis.text.x = element_markdown(),\n        legend.text = element_markdown(),\n        legend.key.size = unit(10, \"pt\"))\nggsave(\"figures/stacked_taxa.png\", width=5, height=4)\n\n#---------------------------------------\n\nphylum_rel_abund <- otu_rel_abund %>%\n  filter(level==\"phylum\",\n         !grepl(\".*unassigned.*|.*nclassified.*|.*ncultured.*\",taxon)) %>%\n  group_by(bmi, sample_id, taxon) %>%\n  summarise(rel_abund = sum(rel_abund), .groups=\"drop\") %>%\n  group_by(bmi, taxon) %>%\n  summarise(mean_rel_abund = 100*mean(rel_abund), .groups=\"drop\") %>%\n  mutate(taxon = str_replace(taxon, \"(.*)_unclassified\", \"Unclassified<br>*\\\\1*\"),\n         taxon = str_replace(taxon, \"^$\", \"*\\\\1*\"),\n         taxon = str_replace(taxon, \"_\", \" \"))\n\n## Pool low abundance to \"Others\"\ntaxon_pool <- phylum_rel_abund %>%\n  group_by(taxon) %>%\n  summarise(pool = max(mean_rel_abund) < 1,\n            mean = mean(mean_rel_abund), .groups=\"drop\")\n\n\ninner_join(phylum_rel_abund, taxon_pool, by=\"taxon\") %>%\n  mutate(taxon = if_else(pool, \"Other\", taxon)) %>%\n  group_by(bmi, taxon) %>%\n  summarise(mean_rel_abund = sum(mean_rel_abund),\n            mean = min(mean), .groups=\"drop\") %>%\n  mutate(taxon = factor(taxon),\n         taxon = fct_reorder(taxon, mean, .desc=TRUE),\n         taxon = fct_shift(taxon, n=1)) %>%\n  ggplot(aes(y=taxon, x = mean_rel_abund, fill= bmi)) +\n  geom_col(width=0.8, position = position_dodge()) +\n  labs(y = NULL, x = \"Mean Relative Abundance\", subtitle = \"Phyla grouped by BMI category\", fill = NULL) +\n  theme_classic() +\n  theme(axis.text.x = element_markdown(angle = 0, hjust = 1, vjust = 1),\n        axis.text.y = element_markdown(),\n        legend.text = element_markdown(),\n        legend.key.size = unit(12, \"pt\"),\n        panel.background = element_blank(),\n        # panel.grid.major.x =  element_line(colour = \"lightgray\", size = 0.1),\n        panel.border = element_blank()) +\n  guides(fill = guide_legend(ncol=1)) +\n  scale_x_continuous(expand = c(0, 0))\nggsave(\"figures/grouped_phyla.png\", width=5, height=4)\n#---------------------------------------\n\ntaxon_rel_abund <- otu_rel_abund %>%\n  filter(level==\"genus\",\n         !grepl(\".*unassigned.*|.*nclassified.*|.*ncultured.*\",taxon)) %>%\n  group_by(bmi, sample_id, taxon) %>%\n  summarise(rel_abund = sum(rel_abund), .groups=\"drop\") %>%\n  group_by(bmi, taxon) %>%\n  summarise(mean_rel_abund = 100*mean(rel_abund), .groups=\"drop\") %>%\n  mutate(taxon = str_replace(taxon, \"(.*)_unclassified\", \"Unclassified<br>*\\\\1*\"),\n         taxon = str_replace(taxon, \"^$\", \"*\\\\1*\"),\n         taxon = str_replace(taxon, \"_\", \" \"))\n\n## Pool low abundance to \"Others\"\n\ntaxon_pool <- taxon_rel_abund %>%\n  group_by(taxon) %>%\n  summarise(pool = max(mean_rel_abund) < 2,\n            mean = mean(mean_rel_abund), .groups=\"drop\")\n\n## Plotting\ninner_join(taxon_rel_abund, taxon_pool, by=\"taxon\") %>%\n  mutate(taxon = if_else(pool, \"Other\", taxon)) %>%\n  group_by(bmi, taxon) %>%\n  summarise(mean_rel_abund = sum(mean_rel_abund),\n            mean = min(mean), .groups=\"drop\") %>%\n  mutate(taxon = factor(taxon),\n         taxon = fct_reorder(taxon, mean, .desc=TRUE),\n         taxon = fct_shift(taxon, n=1)) %>%\n  ggplot(aes(y=taxon, x = mean_rel_abund, fill= bmi)) +\n  geom_col(width=0.8, position = position_dodge()) +\n  labs(y = NULL, x = \"Mean Relative Abundance\", subtitle = \"Taxa grouped by BMI category\", fill = NULL) +\n  theme_classic() +\n  theme(axis.text.x = element_markdown(angle = 0, hjust = 1, vjust = 1),\n        axis.text.y = element_markdown(),\n        legend.text = element_markdown(),\n        legend.key.size = unit(12, \"pt\"),\n        panel.background = element_blank(),\n        # panel.grid.major.x =  element_line(colour = \"lightgray\", size = 0.1),\n        panel.border = element_blank()) +\n  guides(fill = guide_legend(ncol=1)) +\n  scale_x_continuous(expand = c(0, 0))\nggsave(\"figures/grouped_taxa.png\", width=5, height=4)\n#---------------------------------------\n\nphylum <- ps_df %>%\n  filter(level == \"phylum\") \n\nphylum_pool <- phylum %>%\n  group_by(taxon) %>%\n  summarise(pool = max(rel_abund) < 0.02,\n            mean = mean(rel_abund), .groups=\"drop\")  \n  \ninner_join(phylum, phylum_pool, by=\"taxon\") %>%\n  mutate(taxon = if_else(pool, \"Other\", taxon)) %>%\n  ggplot(aes(x = sample_id, y = 100*rel_abund, fill = taxon)) +\n  theme_bw() + \n  geom_bar(stat = \"identity\", position = position_stack()) +\n  labs(x=\"Sample\", y=\"Relative Abundance\", subtitle = \"Taxa Relative Abundance faceted by group\", fill = NULL) +\n  facet_grid(~ nationality, space = \"free\", scales = \"free\") +\n  theme(axis.text.x = element_blank(),\n        legend.text = element_markdown(),\n        strip.background = element_rect(colour = \"lightblue\", fill = \"lightblue\")) +\n  scale_fill_manual(name=NULL,\n                    breaks=c(\"*Actinobacteria*\",\"*Bacteroidetes*\", \"*Firmicutes*\",\"*Proteobacteria*\", \"*Verrucomicrobia*\", \"Other\"),\n                    labels=c(\"*Actinobacteria*\",\"*Bacteroidetes*\", \"*Firmicutes*\",\"*Proteobacteria*\", \"*Verrucomicrobia*\", \"Other\"),\n                    values = c(brewer.pal(5, \"Paired\"), \"gray\"))\nggsave(\"figures/faceted_phyla_bar.png\", width=5, height=4)\n#---------------------------------------\n\ngenus <-  ps_df %>%\n  filter(level == \"genus\") \n\ngenus_pool <- genus %>%\n  group_by(taxon) %>%\n  summarise(pool = max(rel_abund) < 0.15,\n            mean = mean(rel_abund), .groups=\"drop\")  \n  \ninner_join(genus, genus_pool, by=\"taxon\") %>%\n  mutate(taxon = if_else(pool, \"Other\", taxon)) %>%\n  ggplot(aes(x = sample_id, y = 100*rel_abund, fill = taxon)) +\n  theme_bw() + \n  geom_bar(stat = \"identity\", position = position_stack()) +\n  labs(x=\"Sample\", y=\"Relative Abundance\", subtitle = \"Taxa Relative Abundance faceted by group\", fill = NULL) +\n  facet_grid(~ nationality, space = \"free\", scales = \"free\") +\n  theme(axis.text.x = element_blank(),\n        legend.text = element_markdown(),\n        strip.background = element_rect(colour = \"lightblue\", fill = \"lightblue\"))\nggsave(\"figures/faceted_taxa_bar.png\", width=5, height=4)\n#---------------------------------------\n\nps_rel %>% \nmicrobial::plotbar( level=\"Phylum\", group = \"nationality\", top = 10) +\n  theme(axis.text.x = element_text(angle = 0)) + \n  labs(x=\"Sample\", \n       y=\"Relative Abundance\", \n       subtitle = \"Phyla Relative Abundance by plotbar()\\nin microbial package\", \n       fill = NULL)\nggsave(\"figures/plotbar_phyla_bar.png\", width=5, height=4)\n\n#---------------------------------------\n\nps_rel %>% \nmicrobial::plotbar(level=\"Genus\", group = \"nationality\", top = 10) +\n  theme(axis.text.x = element_text(angle = 0)) + \n  labs(x=\"Sample\", \n       y=\"Relative Abundance\", \n       subtitle = \"Taxa Relative Abundance by plotbar()\\nin microbial package\", \n       fill = NULL)\nggsave(\"figures/plotbar_taxa_bar.png\", width=5, height=4)\n#---------------------------------------\n# Using ggpubr package\n#---------------------------------------\n\nlibrary(ggpubr)\nlibrary(RColorBrewer)\nlibrary(viridis)\n\npsmelt(ps_rel) %>% \n  select(Sample, nationality, Phylum, Abundance) %>% \n  group_by(Sample, nationality, Phylum) %>% \n  summarise(Abundance = sum(Abundance), .groups = \"drop\") %>% \n  filter(Abundance > 0.01) %>% \n  mutate(Phylum = fct_reorder(Phylum, -Abundance)) %>% \n  ggbarplot(x = \"Phylum\", y = \"Abundance\", \n            fill = \"nationality\",\n            color = \"nationality\",\n            palette = \"jco\",\n            sort.by.groups = FALSE,     \n            rotate = TRUE,\n            position = position_dodge()) +\n  theme_classic() +\n  theme(axis.text.x = element_markdown(angle = 0, hjust = 1, vjust = 1),\n        axis.text.y = element_markdown(),\n        legend.text = element_markdown(),\n        legend.key.size = unit(12, \"pt\"))  +\n  labs(x=NULL, \n       y=\"Relative Abundance (%)\",\n       subtitle = \"Phyla Relative Abundance by ggbarplot()\\nin ggpubr package grouped by nationality\", \n       fill = NULL) +\n  guides(color = \"none\")\nggsave(\"figures/ggpubr_phyla_bar.png\", width=5, height=4)\n#------------------------------\n# Plot top n\n#------------------------------\nlibrary(phyloseq)\nlibrary(tidyverse)\nlibrary(ggpubr)\n\ndf <- psmelt(ps_rel) %>% \n  select(Sample, nationality, Genus, Abundance) %>% \n  group_by(Sample, nationality, Genus) %>% \n  summarise(Abundance = sum(Abundance), .groups = \"drop\")\n\n# Function\ntop_n_unique <- function(df, n, group_var, value_var) {\n  df %>%\n    group_by({{ group_var }}) %>%\n    mutate(rank = dense_rank(desc({{ value_var }}))) %>%\n    filter(rank <= n) %>%\n    ungroup() %>%\n    select(-rank)\n}\n\n# Plot\nn <- 10  # Number of top unique taxa to select\ntop_n_unique(df, n, Genus, Abundance) %>% \n  filter(Abundance > 0.2) %>% \n  mutate(Genus = fct_reorder(Genus, -Abundance)) %>% \n  ggbarplot(x = \"Genus\", y = \"Abundance\", \n            fill = \"nationality\",\n            color = \"nationality\",\n            palette = \"jco\",\n            sort.by.groups = FALSE,     \n            rotate = TRUE,\n            position = position_dodge()) +\n  theme_classic() +\n  theme(axis.text.x = element_markdown(angle = 0, hjust = 1, vjust = 1),\n        axis.text.y = element_markdown(),\n        legend.text = element_markdown(),\n        legend.key.size = unit(12, \"pt\"))  +\n  labs(x=NULL, \n       y=\"Relative Abundance (%)\",\n       subtitle = \"Genera Relative Abundance by ggbarplot()\\nin ggpubr package grouped by nationality\", \n       fill = NULL) +\n  guides(color = \"none\")\nggsave(\"figures/ggpubr_top_n_bar.png\", width=5, height=4)"},{"path":"differential-analysis-of-microbiome-data.html","id":"differential-analysis-of-microbiome-data","chapter":"5 Differential Analysis of Microbiome Data","heading":"5 Differential Analysis of Microbiome Data","text":"Differential abundance analysis fundamental technique microbiome research used identify features exhibit significant differences abundance across different biological conditions treatments. analysis crucial understanding dynamics microbial communities response various environmental factors. section, explore different methods conducting differential abundance analysis using microbiome data.","code":""},{"path":"differential-analysis-of-microbiome-data.html","id":"using-run_lefse-in-microbiomemaker-package","chapter":"5 Differential Analysis of Microbiome Data","heading":"5.1 Using run_lefse() in microbiomeMaker Package","text":"run_lefse() function microbiomeMaker R package provides convenient method performing Differential Abundance Analysis microbiome data. leveraging Linear Discriminant Analysis Effect Size (LEfSe) algorithm, run_lefse() enables researchers interpret results context biological class labels, uncovering important insights microbial community dynamics.Dataset: dietswapDataset: caporaso","code":"\nlibrary(phyloseq)\nlibrary(microbiomeMarker)\n\n# Run LEfSe analysis\nrun_lefse(\n  psextra_raw,\n  wilcoxon_cutoff = 0.0001,\n  group = \"nationality\",\n  taxa_rank = \"Genus\",\n  transform = \"log10p\",\n  kw_cutoff = 0.01,\n  multigrp_strat = TRUE,\n  lda_cutoff = 2\n) %>% \nplot_heatmap(group = \"nationality\", color = \"rainbow\")\nlibrary(microbiomeMarker)\n\nps_caporaso <- ps_caporaso %>%  tax_fix()\n\nrun_lefse(\n    ps_caporaso, \n    wilcoxon_cutoff = 0.001,\n    group = \"SampleType\",\n    taxa_rank = \"Genus\",\n    transform = \"log10p\",\n    kw_cutoff = 0.01,\n    multigrp_strat = TRUE,\n    lda_cutoff = 2) %>%\n  plot_heatmap(group = \"SampleType\", color = \"rainbow\")"},{"path":"differential-analysis-of-microbiome-data.html","id":"cladogram-on-kostic_crc-dataset","chapter":"5 Differential Analysis of Microbiome Data","heading":"5.2 Cladogram on kostic_crc dataset","text":"Using plot_cladogram() microbiomeMarker package","code":"\nlibrary(microbiomeMarker)\nkostic_crc_small <- phyloseq::subset_taxa(\n    ps_kostic_crc,\n    Phylum %in% c(\"Firmicutes\")\n)\nmm_lefse <- run_lefse(\n    kostic_crc_small,\n    wilcoxon_cutoff = 0.01,\n    group = \"DIAGNOSIS\",\n    kw_cutoff = 0.01,\n    multigrp_strat = TRUE,\n    lda_cutoff = 4\n)\nplot_cladogram(mm_lefse, color = c(\"darkgreen\", \"red\"))"},{"path":"ordination-plots.html","id":"ordination-plots","chapter":"6 Ordination Plots","heading":"6 Ordination Plots","text":"","code":""},{"path":"ordination-plots.html","id":"ordination-with-auto-caption","chapter":"6 Ordination Plots","heading":"6.1 Ordination with auto caption","text":"","code":"\nlibrary(microViz)\n\n# perform ordination\npsextra_clr_dietswap %>%\n  ord_calc(method = \"PCA\") %>%\n  ord_plot(\n    plot_taxa = 1:6, colour = \"bmi_group\", size = 1.5,\n    tax_vec_length = 0.325,\n    tax_lab_style = tax_lab_style(max_angle = 90, aspect_ratio = 0.5),\n    auto_caption = 8\n  )"},{"path":"ordination-plots.html","id":"customizing-an-ordination-plot","chapter":"6 Ordination Plots","heading":"6.2 Customizing an ordination plot","text":"","code":"\nlibrary(ggplot2)\n\n# customise plot\npsextra_clr_dietswap %>%\n  ord_calc(method = \"PCA\") %>%\n  ord_plot(\n    plot_taxa = 1:6, colour = \"bmi_group\", size = 1.5,\n    tax_vec_length = 0.325,\n    tax_lab_style = tax_lab_style(max_angle = 90, aspect_ratio = 0.5),\n    auto_caption = 8) +\n  stat_ellipse(aes(linetype = bmi_group, colour = bmi_group), linewidth = 0.3) + # linewidth not size, since ggplot 3.4.0\n  scale_colour_brewer(palette = \"Set1\") +\n  theme(legend.position = \"right\") +\n  coord_fixed(ratio = 0.5, clip = \"off\") # makes rotated labels align correctly"},{"path":"patterns-and-associations-analysis.html","id":"patterns-and-associations-analysis","chapter":"7 Patterns and Associations Analysis","heading":"7 Patterns and Associations Analysis","text":"section, explore methods analyzing patterns associations within datasets. methods instrumental uncovering relationships variables, identifying underlying patterns, elucidating complex structures within data. Specifically, discuss correlation analysis, heatmap visualization, hierarchical clustering, techniques exploring patterns associations various types datasets.","code":""},{"path":"patterns-and-associations-analysis.html","id":"correlation-analysis-and-visualization","chapter":"7 Patterns and Associations Analysis","heading":"7.1 Correlation analysis and visualization","text":"Correlation analysis quantifies strength direction linear relationship two continuous variables. helps understanding variables related can identify potential associations dependencies within data. Heatmap visualization commonly integrated correlation analysis visually represent correlation matrices, allowing identification patterns relationships variables.","code":""},{"path":"patterns-and-associations-analysis.html","id":"pearson-correlation-heatmap-with-microviz-package","chapter":"7 Patterns and Associations Analysis","heading":"7.1.1 Pearson Correlation Heatmap with microViz Package","text":"section, utilize cor_heatmap function available microViz package generate heatmap visualizing Pearson correlation coefficients variables. technique allows exploration relationships patterns within data, providing insights strength direction linear associations variables.Note: parameter min_prevalence = 0.1 set, equivalent approximately 23 222 samples. value may vary depending dataset. Adjust necessary.","code":"\nps_extra <- ps_dietswap %>%\ntax_transform(\n  trans = \"clr\",\n  rank = \"Genus\",\n  keep_counts = TRUE,\n  zero_replace = 0,\n  add = 0,\n  transformation = NULL\n)\n# Load required packages\nlibrary(phyloseq)\nlibrary(microViz)\n\n# Set up the data with numerical variables and filter to top taxa\nps <- ps_dietswap %>%\n  ps_mutate(\n    bmi = recode(bmi_group, obese = 3, overweight = 2, lean = 1),\n    female = if_else(sex == \"female\", true = 1, false = 0),\n    african = if_else(nationality == \"AFR\", true = 1, false = 0)\n  ) %>%\n  tax_filter(\n    tax_level = \"Genus\", min_prevalence = 1 / 10, min_sample_abundance = 1 / 10\n  ) %>%\n  tax_transform(\"identity\", rank = \"Genus\")\n\n# Randomly select 30 taxa from the 50 most abundant taxa (just for demo)\nset.seed(123)\ntop_taxa <- tax_top(ps_dietswap, n = 10, by = sum, rank = \"unique\", use_counts = FALSE)\n\ntaxa <- sample(tax_top(ps_dietswap, n = 50), size = 30)\n\n# Clean the data and draw the correlation heatmap \ncor_heatmap(\n  data = ps, \n  taxa = taxa,\n  taxon_renamer = function(x) stringr::str_remove(x, \" [ae]t rel.\"),\n  tax_anno = taxAnnotation(\n    Prev. = anno_tax_prev(undetected = 50),\n    Log2 = anno_tax_box(undetected = 50, trans = \"log2\", zero_replace = 1)\n  )\n)"},{"path":"patterns-and-associations-analysis.html","id":"hierarchical-clustering","chapter":"7 Patterns and Associations Analysis","heading":"7.2 Hierarchical clustering","text":"Hierarchical clustering method grouping similar observations variables together based similarity dissimilarity. creates hierarchical tree-like structure (dendrogram) illustrates relationships clusters, allowing identification natural groupings patterns within data.","code":""},{"path":"phylogenetic-analysis.html","id":"phylogenetic-analysis","chapter":"8 Phylogenetic Analysis","heading":"8 Phylogenetic Analysis","text":"Phylogenetic analysis essential microbiome research understanding evolutionary relationships microbial taxa. section, explore various tools techniques phylogenetic analysis.","code":""},{"path":"phylogenetic-analysis.html","id":"view-a-tree-by-ape-and-ggtree-r-packages","chapter":"8 Phylogenetic Analysis","heading":"8.1 View a tree by ape and ggtree R packages","text":"","code":"\nset.seed(1234)\n\nlibrary(ape)\nlibrary(ggtree)\n\ntree <- rtree(20)\nggtree(tree)"},{"path":"phylogenetic-analysis.html","id":"cladogram-using-ggtree-function","chapter":"8 Phylogenetic Analysis","heading":"8.2 Cladogram using ggtree() function","text":"","code":"\nlibrary(ape)\nlibrary(ggtree)\n\n\nggtree(\n  phy_tree(ps_caporaso),\n  mapping = NULL,\n  layout = \"circular\",\n  open.angle = 0,\n  mrsd = NULL,\n  as.Date = FALSE,\n  yscale = \"none\",\n  yscale_mapping = NULL,\n  ladderize = TRUE,\n  right = FALSE,\n  branch.length = \"branch.length\",\n  root.position = 0,\n  xlim = NULL\n)"},{"path":"statistical-significance-analysis.html","id":"statistical-significance-analysis","chapter":"10 Statistical Significance Analysis","heading":"10 Statistical Significance Analysis","text":"section delves statistical analysis methods tailored specifically microbiome data. Statistical analysis plays crucial role understanding complex relationships patterns within microbiome datasets, helping researchers uncover significant findings insights microbial community dynamics, composition, responses various environmental factors treatments.","code":"\n# Load required packages\nlibrary(phyloseq)\nlibrary(tidyverse)\n\ncat(\"\\nSaved RData objects\\n\\n\")\nSaved RData objects\nload(\"data/dataframe_objects.rda\", verbose = T)Loading objects:\n  df_GlobalPatterns\n  df_dietswap\n  df_caporaso\n  df_kostic_crc\nload(\"data/phyloseq_objects.rda\", verbose = T)Loading objects:\n  ps_GlobalPatterns\n  ps_dietswap\n  ps_caporaso\n  ps_kostic_crc\nload(\"data/phyloseq_extra_objects.rda\", verbose = T)Loading objects:\n  psextra_clr_dietswap\n  psextra_id_dietswap\n  psextra_log10p_dietswap\nload(\"data/ps_transformed.rda\", verbose = T)Loading objects:\n  ps_asin\n  ps_identity\n  ps_compositional\n  ps_z_otu\n  ps_z_sample\n  ps_log10\n  ps_log10p\n  ps_clr\n  ps_shift\n  ps_scale\nload(\"data/bray_distances.rda\", verbose = T)Loading objects:\n  ps_asin_bray_dist\n  ps_compositional_bray_dist\n  ps_z_otu_bray_dist\n  ps_z_sample_bray_dist\n  ps_log10_bray_dist\n  ps_log10p_bray_dist\n  ps_clr_bray_dist\n  ps_shift_bray_dist\n  ps_scale_bray_dist\nload(\"data/psextra_distances.rda\", verbose = T)Loading objects:\n  psextra_clr_asin_bray_dist\n  psextra_id_asin_bray_dist\n  psextra_log10p_asin_bray_dist\nload(\"data/reduced_dimension.rda\", verbose = T)Loading objects:\n  pca_asin_bray_metrics\n  mds_asin_bray_metrics\n  pcoa_asin_bray_metrics\n  tsne_asin_bray_metrics"},{"path":"statistical-significance-analysis.html","id":"permanova","chapter":"10 Statistical Significance Analysis","heading":"10.1 PERMANOVA","text":"PERMANOVA (Permutational Multivariate Analysis Variance) statistical test used assess significance differences groups microbial communities. Particularly suited analyzing multivariate data like microbiome composition, PERMANOVA offers valuable insights different experimental conditions treatments impact microbial community structure.","code":"\nlibrary(microViz) \n\nbray_perm <- psextra_log10p_asin_bray_dist %>%\n  dist_permanova(\n    seed = 1234, # for set.seed to ensure reproducibility of random process\n    n_processes = 1, n_perms = 99, # you should use at least 999!\n    variables = \"bmi_group\"\n  )\n\nperm_get(bray_perm) %>% as.data.frame()           Df  SumOfSqs         R2        F Pr(>F)\nbmi_group   2 0.1233611 0.04544245 5.212833   0.01\nResidual  219 2.5913059 0.95455755       NA     NA\nTotal     221 2.7146670 1.00000000       NA     NA\ninfo_get(bray_perm)psExtra info:\ntax_agg = \"Genus\" tax_trans = \"log10p\" dist_method = \"bray\" "},{"path":"imap-github-repos.html","id":"imap-github-repos","chapter":"A IMAP GitHub Repos","heading":"A IMAP GitHub Repos","text":"","code":""},{"path":"data-exploration-rulegraph.html","id":"data-exploration-rulegraph","chapter":"B Data Exploration Rulegraph","heading":"B Data Exploration Rulegraph","text":"","code":""},{"path":"session-information.html","id":"session-information","chapter":"C Session Information","heading":"C Session Information","text":"Reproducibility relies ability precisely recreate working environment, session information serves vital reference achieve consistency. record details R environment, package versions, system settings computing environment time analysis.","code":"\nlibrary(sessioninfo)\n\n# Get session info\ninfo <- capture.output(print(session_info()))\n\n# Define patterns to exclude\nexclude_patterns <- c(\"/Users/.*\", \"Africa/Dar_es_Salaam\") # This line is location-dependent\n\n# Exclude lines containing specific information\ninfo_filtered <- info[!grepl(paste(exclude_patterns, collapse = \"|\"), info)]\n\n# Save the filtered session info to a text file in the root directory without line numbers\ncat(info_filtered, file = \"session_info.txt\", sep = \"\\n\")"},{"path":"references.html","id":"references","chapter":"References","heading":"References","text":"","code":""}]
